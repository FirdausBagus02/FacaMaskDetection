#include <CTBot.h> //libary telegram

// input sensor dan led
#define pinreed   5 //D1 - GPIO5
#define pinled1   4 //D2 - GPIO4
#define buzzer    14//D5

// sediakan object untuk CTBot
CTBot myBot;

// konfigurasi WIFI
String ssid = "........"; // sesuaikan dengan wifi masing masing
String pass = "........"; // sesuaikan dengan wifi masing masing

// konfigurasi telegram
String token = "........."; // isi sesuai dengan token yang telah didapat
const int id = ........ ; // isi dengan id telegram pengguna

void setup() {
  Serial.begin(9600);
  pinMode(pinreed, OUTPUT);
  pinMode(pinled1, OUTPUT);
  pinMode(buzzer, OUTPUT);

  // koneksikan nodemcu dengan telegram

  myBot.wifiConnect(ssid, pass);
  myBot.setTelegramToken(token);
  
  // tes telegram
  if(myBot.testConnection())
  {
    digitalWrite(pinled1, HIGH);
    }
  else
  {
    digitalWrite(pinled1, LOW);
  }
}

void loop() 
{
  //membaca nilai sensor reed
  int reed = digitalRead(pinreed);
  Serial.println(reed);
  // uji nilai sensor reed
  if(reed==0)
  {
  // aktifkan buzzer 
  digitalWrite(buzzer, HIGH);
  // kirim notif
  myBot.sendMessage(id, "pintu anda terbuka, mohon berhati-hati");
  }
  else
  {
  // matikan buzzer
  digitalWrite (buzzer, LOW);
  }
   
  delay(300);

}
